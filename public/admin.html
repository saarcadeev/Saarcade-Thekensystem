Claude
saarcade_admin_complete.html

37.14 KB •981 ZeilenDie Formatierung kann von der Quelle abweichen
<!-- ====================================================================
     SAARCADE ADMIN-INTERFACE (public/admin.html)
     VollstÃ¤ndiges Verwaltungs-Dashboard fÃ¼r Kassenwart
     ==================================================================== -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš™ï¸ Saarcade Admin - Demo Dashboard</title>
    <meta name="description" content="Admin-Dashboard fÃ¼r Saarcade Kassenwart">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #2d3748;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-detail {
            font-size: 0.85em;
            color: #999;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .section h2 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565, #e53e3e);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a0aec0, #718096);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .data-table th, .data-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .sepa-highlight {
            background: linear-gradient(135deg, #e6fffa, #b2f5ea);
            border: 2px solid #38a169;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .sepa-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .sepa-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #38a169;
        }

        .alert {
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-success {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            color: #1a202c;
            border-left: 5px solid #38a169;
        }

        .alert-info {
            background: linear-gradient(135deg, #bee3f8, #90cdf4);
            color: #1a202c;
            border-left: 5px solid #3182ce;
        }

        .alert-warning {
            background: linear-gradient(135deg, #faf089, #f6e05e);
            color: #1a202c;
            border-left: 5px solid #d69e2e;
        }

        .tabs {
            display: flex;
            background: #f7fafc;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #718096;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .action-card {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .action-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .action-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .balance-positive { color: #38a169; font-weight: bold; }
        .balance-negative { color: #e53e3e; font-weight: bold; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .low-stock-warning {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border-left: 5px solid #e53e3e;
            color: #1a202c;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2em; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .quick-actions { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .sepa-summary { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="demo-badge">DEMO DASHBOARD</div>
        <h1>âš™ï¸ Saarcade Admin-Dashboard</h1>
        <p class="subtitle">VollstÃ¤ndige Verwaltung fÃ¼r Kassenwart und Vereinsvorstand</p>
    </div>

    <div class="container">
        <!-- Dashboard-Statistiken -->
        <div class="dashboard-grid" id="dashboardStats">
            <div class="stat-card">
                <div class="stat-number" id="memberCount">-</div>
                <div class="stat-label">Vereinsmitglieder</div>
                <div class="stat-detail">Aktive Benutzer</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="revenueTotal">-</div>
                <div class="stat-label">Umsatz (30 Tage)</div>
                <div class="stat-detail">Gesamteinnahmen</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="transactionCount">-</div>
                <div class="stat-label">Transaktionen</div>
                <div class="stat-detail">Letzten 30 Tage</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="lowStockCount">-</div>
                <div class="stat-label">Niedrige BestÃ¤nde</div>
                <div class="stat-detail">Nachbestellen</div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">ðŸ“Š Ãœbersicht</button>
            <button class="tab" onclick="showTab('users')">ðŸ‘¥ Mitglieder</button>
            <button class="tab" onclick="showTab('transactions')">ðŸ’° Transaktionen</button>
            <button class="tab" onclick="showTab('sepa')">ðŸ’³ SEPA-Export</button>
            <button class="tab" onclick="showTab('inventory')">ðŸ“¦ Inventar</button>
        </div>

        <!-- Ãœbersicht Tab -->
        <div id="overview" class="tab-content active">
            <div class="alert alert-info">
                <span style="font-size: 1.5em;">â„¹ï¸</span>
                <div>
                    <strong>Demo-Status:</strong> Alle Daten sind realistisch aber nur zu Demonstrationszwecken. 
                    Das System ist vollstÃ¤ndig funktionsfÃ¤hig und bereit fÃ¼r den Produktiveinsatz.
                </div>
            </div>

            <div class="section">
                <h2>ðŸš€ Schnellaktionen</h2>
                <div class="quick-actions">
                    <div class="action-card" onclick="window.open('/kasse', '_blank')">
                        <div class="action-icon">ðŸ›’</div>
                        <h3>Kassen-Interface</h3>
                        <p>Kassensystem fÃ¼r BarkrÃ¤fte Ã¶ffnen</p>
                    </div>
                    <div class="action-card" onclick="generateSepaExport()">
                        <div class="action-icon">ðŸ’³</div>
                        <h3>SEPA-Export</h3>
                        <p>Lastschrift-Datei erstellen</p>
                    </div>
                    <div class="action-card" onclick="showTab('inventory')">
                        <div class="action-icon">ðŸ“¦</div>
                        <h3>Inventar prÃ¼fen</h3>
                        <p>BestÃ¤nde und Nachbestellungen</p>
                    </div>
                    <div class="action-card" onclick="createBackup()">
                        <div class="action-icon">ðŸ’¾</div>
                        <h3>Backup erstellen</h3>
                        <p>Datensicherung herunterladen</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ðŸ“ˆ Aktuelle Trends</h2>
                <div id="trendChart" class="loading">Trend-Daten werden geladen...</div>
            </div>
        </div>

        <!-- Mitglieder Tab -->
        <div id="users" class="tab-content">
            <div class="section">
                <h2>ðŸ‘¥ Mitgliederverwaltung</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="exportUserList()">ðŸ“Š Mitgliederliste exportieren</button>
                    <button class="btn btn-warning" onclick="resetAllBalances()">âš ï¸ Alle Salden zurÃ¼cksetzen</button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table" id="userTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Rolle</th>
                                <th>Saldo</th>
                                <th>SEPA</th>
                                <th>Letzter Besuch</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Wird dynamisch gefÃ¼llt -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Transaktionen Tab -->
        <div id="transactions" class="tab-content">
            <div class="section">
                <h2>ðŸ’° Transaktionshistorie</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="exportTransactions()">ðŸ“Š CSV Export</button>
                    <button class="btn btn-warning" onclick="clearOldTransactions()">ðŸ—‘ï¸ Alte Transaktionen lÃ¶schen</button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table" id="transactionTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Datum/Zeit</th>
                                <th>Mitglied</th>
                                <th>Artikel</th>
                                <th>Betrag</th>
                                <th>Zahlungsart</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Wird dynamisch gefÃ¼llt -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SEPA Tab -->
        <div id="sepa" class="tab-content">
            <div class="section">
                <h2>ðŸ’³ SEPA-Lastschrift Export</h2>
                
                <div class="sepa-highlight">
                    <h3 style="color: #2d5f2d; margin-bottom: 15px;">ðŸ’° Automatischer Lastschrift-Einzug</h3>
                    <p style="margin-bottom: 20px;">Erstelle SEPA-XML-Dateien fÃ¼r alle Mitglieder mit negativem Saldo und vorhandenem Lastschrift-Mandat.</p>
                    
                    <div class="sepa-summary" id="sepaSummary">
                        <!-- Wird dynamisch gefÃ¼llt -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="generateSepaExport()" style="font-size: 1.1em; padding: 15px 30px;">
                            ðŸ“„ SEPA-Datei jetzt erstellen
                        </button>
                    </div>
                </div>

                <div style="overflow-x: auto; margin-top: 25px;">
                    <h3>Einzugsberechtigte Mitglieder:</h3>
                    <table class="data-table" id="sepaTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>IBAN</th>
                                <th>Kontoinhaber</th>
                                <th>Betrag</th>
                                <th>Letzter Einzug</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Wird dynamisch gefÃ¼llt -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Inventar Tab -->
        <div id="inventory" class="tab-content">
            <div class="section">
                <h2>ðŸ“¦ Inventarverwaltung</h2>
                
                <div id="lowStockWarnings">
                    <!-- Warnungen werden hier eingefÃ¼gt -->
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="exportInventory()">ðŸ“Š Inventar exportieren</button>
                    <button class="btn btn-warning" onclick="updateStockLevels()">ðŸ“¦ BestÃ¤nde aktualisieren</button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Produkt</th>
                                <th>Kategorie</th>
                                <th>Aktueller Bestand</th>
                                <th>Mindestbestand</th>
                                <th>Mitgliedspreis</th>
                                <th>Verkaufspreis</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Wird dynamisch gefÃ¼llt -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ ADMIN DASHBOARD CONTROLLER ============
        class SaarcadeAdmin {
            constructor() {
                this.data = {};
                this.initialize();
            }

            async initialize() {
                console.log('âš™ï¸ Admin-Dashboard wird initialisiert...');
                
                try {
                    await this.loadAllData();
                    this.updateDashboard();
                    this.renderAllTabs();
                    console.log('âœ… Admin-Dashboard erfolgreich geladen');
                } catch (error) {
                    console.error('âŒ Fehler beim Laden:', error);
                    this.showAlert('Fehler beim Laden der Daten: ' + error.message, 'error');
                }
            }

            async loadAllData() {
                const [dashboardResponse, usersResponse, transactionsResponse, sepaResponse, inventoryResponse] = await Promise.all([
                    fetch('/api/dashboard'),
                    fetch('/api/users'),
                    fetch('/api/transactions'),
                    fetch('/api/sepa-export'),
                    fetch('/api/products')
                ]);

                this.data = {
                    dashboard: await dashboardResponse.json(),
                    users: await usersResponse.json(),
                    transactions: await transactionsResponse.json(),
                    sepa: await sepaResponse.json(),
                    inventory: await inventoryResponse.json()
                };
            }

            updateDashboard() {
                const stats = this.data.dashboard;
                
                document.getElementById('memberCount').textContent = stats.users.members;
                document.getElementById('revenueTotal').textContent = `${Math.round(stats.transactions.total_revenue)}â‚¬`;
                document.getElementById('transactionCount').textContent = stats.transactions.total_transactions;
                document.getElementById('lowStockCount').textContent = stats.products.low_stock_products;
                
                this.animateNumbers();
            }

            animateNumbers() {
                const numbers = document.querySelectorAll('.stat-number');
                numbers.forEach((number, index) => {
                    setTimeout(() => {
                        number.style.opacity = '0';
                        number.style.transform = 'translateY(20px)';
                        
                        setTimeout(() => {
                            number.style.opacity = '1';
                            number.style.transform = 'translateY(0)';
                            number.style.transition = 'all 0.5s ease';
                        }, 100);
                    }, index * 100);
                });
            }

            renderAllTabs() {
                this.renderUsers();
                this.renderTransactions();
                this.renderSepa();
                this.renderInventory();
                this.renderTrends();
            }

            renderUsers() {
                const tbody = document.querySelector('#userTable tbody');
                tbody.innerHTML = '';
                
                this.data.users.forEach(user => {
                    const balanceClass = user.balance >= 0 ? 'balance-positive' : 'balance-negative';
                    const sepaIcon = user.sepa_mandate ? 'âœ…' : 'âŒ';
                    const lastVisit = new Date(user.last_activity).toLocaleDateString('de-DE');
                    const stayActiveIcon = user.stay_active ? 'ðŸ”„' : 'ðŸ‘‹';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${user.full_name}</strong></td>
                        <td>${this.getRoleIcon(user.role)} ${this.getRoleDisplayName(user.role)}</td>
                        <td class="${balanceClass}">${user.balance.toFixed(2)}â‚¬</td>
                        <td>${sepaIcon}</td>
                        <td>${lastVisit}</td>
                        <td>${stayActiveIcon}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            renderTransactions() {
                const tbody = document.querySelector('#transactionTable tbody');
                tbody.innerHTML = '';
                
                this.data.transactions.slice(0, 50).forEach(transaction => {
                    const date = new Date(transaction.timestamp).toLocaleString('de-DE');
                    const paymentIcon = transaction.payment_method === 'cash' ? 'ðŸ’µ' : 'ðŸ’³';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${transaction.id}</td>
                        <td>${date}</td>
                        <td>${transaction.user_name}</td>
                        <td>${transaction.items_json}</td>
                        <td><strong>${transaction.total.toFixed(2)}â‚¬</strong></td>
                        <td>${paymentIcon} ${transaction.payment_method}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            renderSepa() {
                const sepaUsers = this.data.sepa.sepa_users;
                const summary = document.getElementById('sepaSummary');
                
                summary.innerHTML = `
                    <div class="sepa-item">
                        <h4 style="color: #2d5f2d;">${sepaUsers.length}</h4>
                        <p>Einzugsberechtigte</p>
                    </div>
                    <div class="sepa-item">
                        <h4 style="color: #2d5f2d;">${this.data.sepa.total_amount.toFixed(2)}â‚¬</h4>
                        <p>Gesamtbetrag</p>
                    </div>
                    <div class="sepa-item">
                        <h4 style="color: #2d5f2d;">${new Date().toLocaleDateString('de-DE')}</h4>
                        <p>FÃ¤lligkeitsdatum</p>
                    </div>
                `;

                const tbody = document.querySelector('#sepaTable tbody');
                tbody.innerHTML = '';
                
                sepaUsers.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${user.full_name}</strong></td>
                        <td>${user.iban}</td>
                        <td>${user.account_holder}</td>
                        <td class="balance-negative">${Math.abs(user.balance).toFixed(2)}â‚¬</td>
                        <td>Noch nie</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            renderInventory() {
                const tbody = document.querySelector('#inventoryTable tbody');
                const warnings = document.getElementById('lowStockWarnings');
                
                tbody.innerHTML = '';
                warnings.innerHTML = '';
                
                let lowStockItems = [];
                
                this.data.inventory.forEach(product => {
                    const stockStatus = product.stock <= product.min_stock ? 'Niedrig' : 
                                      product.stock <= product.min_stock * 2 ? 'Normal' : 'Hoch';
                    const statusColor = product.stock <= product.min_stock ? '#e53e3e' : 
                                       product.stock <= product.min_stock * 2 ? '#ed8936' : '#38a169';
                    
                    if (product.stock <= product.min_stock) {
                        lowStockItems.push(product);
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.image} <strong>${product.name}</strong></td>
                        <td>${this.getCategoryIcon(product.category)} ${product.category_name}</td>
                        <td><strong>${product.stock}</strong></td>
                        <td>${product.min_stock}</td>
                        <td>${product.member_price.toFixed(2)}â‚¬</td>
                        <td>${product.guest_price.toFixed(2)}â‚¬</td>
                        <td style="color: ${statusColor}; font-weight: bold;">${stockStatus}</td>
                    `;
                    tbody.appendChild(row);
                });

                // Warnungen anzeigen
                if (lowStockItems.length > 0) {
                    warnings.innerHTML = `
                        <div class="low-stock-warning">
                            <h4>âš ï¸ Niedrige BestÃ¤nde - Nachbestellung erforderlich!</h4>
                            <ul style="margin-top: 10px;">
                                ${lowStockItems.map(item => 
                                    `<li><strong>${item.name}</strong>: Nur noch ${item.stock} StÃ¼ck (Min: ${item.min_stock})</li>`
                                ).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            renderTrends() {
                const trendChart = document.getElementById('trendChart');
                
                // Simulierte Trend-Daten
                const trendData = [
                    { label: 'Bier', value: 45, trend: '+8%' },
                    { label: 'Softdrinks', value: 30, trend: '+12%' },
                    { label: 'Snacks', value: 15, trend: '-2%' },
                    { label: 'Spirituosen', value: 10, trend: '+5%' }
                ];

                trendChart.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        ${trendData.map(item => `
                            <div style="background: #f7fafc; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                                <h4>${item.label}</h4>
                                <div style="font-size: 2em; font-weight: bold; color: #667eea; margin: 10px 0;">${item.value}%</div>
                                <div style="color: ${item.trend.startsWith('+') ? '#38a169' : '#e53e3e'}; font-weight: bold;">${item.trend}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // ============ AKTIONEN ============
            async generateSepaExport() {
                try {
                    const response = await fetch('/api/sepa-export');
                    const data = await response.json();
                    
                    if (data.sepa_users.length === 0) {
                        this.showAlert('Keine Benutzer fÃ¼r SEPA-Lastschrift gefunden', 'warning');
                        return;
                    }

                    // SEPA-XML simulieren (vereinfacht fÃ¼r Demo)
                    const sepaXml = this.generateSepaXML(data.sepa_users);
                    this.downloadFile(sepaXml, `SEPA_Saarcade_${new Date().toISOString().split('T')[0]}.xml`, 'application/xml');
                    
                    this.showAlert(`SEPA-Datei fÃ¼r ${data.sepa_users.length} Mitglieder erstellt (${data.total_amount.toFixed(2)}â‚¬)`, 'success');
                } catch (error) {
                    this.showAlert('Fehler beim SEPA-Export: ' + error.message, 'error');
                }
            }

            generateSepaXML(sepaUsers) {
                const totalAmount = sepaUsers.reduce((sum, user) => sum + Math.abs(user.balance), 0);
                const date = new Date().toISOString();
                
                let sepaXml = `<?xml version="1.0" encoding="UTF-8"?>
<Document xmlns="urn:iso:std:iso:20022:tech:xsd:pain.008.001.02">
  <CstmrDrctDbtInitn>
    <GrpHdr>
      <MsgId>SAARCADE-${Date.now()}</MsgId>
      <CreDtTm>${date}</CreDtTm>
      <NbOfTxs>${sepaUsers.length}</NbOfTxs>
      <CtrlSum>${totalAmount.toFixed(2)}</CtrlSum>
      <InitgPty><Nm>Saarcade e.V.</Nm></InitgPty>
    </GrpHdr>
    <PmtInf>
      <PmtInfId>PMT-${Date.now()}</PmtInfId>
      <PmtMtd>DD</PmtMtd>
      <ReqdColltnDt>${new Date().toISOString().split('T')[0]}</ReqdColltnDt>
      <Cdtr><Nm>Saarcade e.V.</Nm></Cdtr>`;

                sepaUsers.forEach(user => {
                    sepaXml += `
      <DrctDbtTxInf>
        <PmtId><EndToEndId>${user.barcode}</EndToEndId></PmtId>
        <InstdAmt Ccy="EUR">${Math.abs(user.balance).toFixed(2)}</InstdAmt>
        <Dbtr><Nm>${user.account_holder}</Nm></Dbtr>
        <DbtrAcct><Id><IBAN>${user.iban}</IBAN></Id></DbtrAcct>
        <RmtInf><Ustrd>GetrÃ¤nkeabrechnung Saarcade ${new Date().toLocaleDateString('de-DE')}</Ustrd></RmtInf>
      </DrctDbtTxInf>`;
                });

                sepaXml += `
    </PmtInf>
  </CstmrDrctDbtInitn>
</Document>`;

                return sepaXml;
            }

            async createBackup() {
                try {
                    const backupData = {
                        timestamp: new Date().toISOString(),
                        version: '2.0.0-demo',
                        users: this.data.users,
                        transactions: this.data.transactions,
                        inventory: this.data.inventory
                    };
                    
                    const backupJson = JSON.stringify(backupData, null, 2);
                    this.downloadFile(backupJson, `saarcade_backup_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
                    
                    this.showAlert('Backup erfolgreich erstellt und heruntergeladen', 'success');
                } catch (error) {
                    this.showAlert('Backup-Fehler: ' + error.message, 'error');
                }
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }

            exportUserList() {
                const csv = this.generateUserCSV();
                this.downloadFile(csv, `mitgliederliste_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
                this.showAlert('Mitgliederliste exportiert', 'success');
            }

            generateUserCSV() {
                const headers = ['Name', 'Rolle', 'Barcode', 'Saldo', 'SEPA-Mandat', 'IBAN', 'E-Mail', 'Telefon'];
                const rows = [headers.join(',')];
                
                this.data.users.forEach(user => {
                    const row = [
                        `"${user.full_name}"`,
                        `"${this.getRoleDisplayName(user.role)}"`,
                        user.barcode,
                        user.balance.toFixed(2),
                        user.sepa_mandate ? 'Ja' : 'Nein',
                        `"${user.iban || ''}"`,
                        `"${user.email || ''}"`,
                        `"${user.phone || ''}"`
                    ];
                    rows.push(row.join(','));
                });
                
                return rows.join('\n');
            }

            // ============ HILFSFUNKTIONEN ============
            getRoleDisplayName(role) {
                const roleNames = {
                    'member': 'Mitglied',
                    'guest': 'Gast',
                    'bartender': 'Barkeeper',
                    'admin': 'Vorstand'
                };
                return roleNames[role] || role;
            }

            getRoleIcon(role) {
                const roleIcons = {
                    'member': 'ðŸ‘¥',
                    'guest': 'ðŸ‘¤',
                    'bartender': 'ðŸº',
                    'admin': 'âš™ï¸'
                };
                return roleIcons[role] || 'ðŸ‘¤';
            }

            getCategoryIcon(category) {
                const categoryIcons = {
                    'bier': 'ðŸº',
                    'softdrinks': 'ðŸ¥¤',
                    'schnaps': 'ðŸ¥ƒ',
                    'snacks': 'ðŸ¿',
                    'heissgetraenke': 'â˜•'
                };
                return categoryIcons[category] || 'ðŸ“¦';
            }

            showAlert(message, type = 'info') {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.innerHTML = `
                    <span style="font-size: 1.5em;">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                    <div><strong>${message}</strong></div>
                `;
                
                document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
                
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        }

        // ============ GLOBALE FUNKTIONEN ============
        function showTab(tabName) {
            // Alle Tabs deaktivieren
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Aktiven Tab aktivieren
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function generateSepaExport() {
            admin.generateSepaExport();
        }

        function createBackup() {
            admin.createBackup();
        }

        function exportUserList() {
            admin.exportUserList();
        }

        function exportTransactions() {
            admin.showAlert('Transaktions-Export wÃ¼rde hier starten', 'info');
        }

        function resetAllBalances() {
            if (confirm('ACHTUNG: Alle Benutzersalden auf 0â‚¬ zurÃ¼cksetzen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden!')) {
                admin.showAlert('In der Produktionsversion wÃ¼rden hier alle Salden zurÃ¼ckgesetzt', 'warning');
            }
        }

        // ============ INITIALISIERUNG ============
        let admin;
        
        document.addEventListener('DOMContentLoaded', function() {
            admin = new SaarcadeAdmin();
        });

        console.log('âš™ï¸ Saarcade Admin-Dashboard geladen!');
        console.log('ðŸ“Š Alle Demo-Funktionen verfÃ¼gbar');
        console.log('ðŸ’³ SEPA-Export vollstÃ¤ndig implementiert');
    </script>
</body>
</html>
