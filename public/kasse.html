// Debug-Script für Kassensystem - In Browser-Console einfügen

console.log('=== KASSENSYSTEM DEBUG ===');

// 1. Grundlegende Elemente prüfen
const barcodeInput = document.getElementById('barcodeInput');
const userDropdown = document.getElementById('userDropdown');
const scannerCompact = document.getElementById('scannerCompact');

console.log('📋 Element-Check:');
console.log('- Barcode Input:', barcodeInput ? '✅' : '❌');
console.log('- User Dropdown:', userDropdown ? '✅' : '❌');
console.log('- Scanner Compact:', scannerCompact ? '✅' : '❌');

// 2. Globale Variablen prüfen
console.log('📋 Variable-Check:');
console.log('- window.kasse:', window.kasse ? '✅' : '❌');
console.log('- users array:', Array.isArray(users) ? `✅ (${users.length} Benutzer)` : '❌');
console.log('- products array:', Array.isArray(products) ? `✅ (${products.length} Produkte)` : '❌');

// 3. Event-Listener testen
console.log('📋 Event-Listener-Test:');
if (barcodeInput) {
    console.log('- Input Events:', barcodeInput._events ? '✅' : '❌');
}

// 4. Dropdown-Test
function testDropdown() {
    console.log('🧪 Testing Dropdown...');
    
    if (!userDropdown) {
        console.error('❌ Dropdown-Element nicht gefunden!');
        return;
    }
    
    // Test-HTML einfügen
    userDropdown.innerHTML = `
        <div class="user-dropdown-item" data-user-id="1">
            <div class="user-dropdown-avatar">M</div>
            <div class="user-dropdown-info">
                <div class="user-dropdown-name">👥 Max Mustermann</div>
                <div class="user-dropdown-details">Mitglied • -15.50€</div>
            </div>
        </div>
    `;
    
    userDropdown.classList.add('show');
    console.log('✅ Test-Dropdown angezeigt');
    
    // Click-Test
    const testItem = userDropdown.querySelector('.user-dropdown-item');
    if (testItem) {
        testItem.addEventListener('click', () => {
            console.log('✅ Dropdown-Click funktioniert!');
            console.log('User ID:', testItem.dataset.userId);
        });
        console.log('✅ Click-Handler hinzugefügt');
    }
}

// 5. Benutzersuche testen
function testUserSearch(query = 'max') {
    console.log(`🧪 Testing User Search with: "${query}"`);
    
    if (!Array.isArray(users)) {
        console.error('❌ Users-Array nicht verfügbar!');
        return;
    }
    
    const filteredUsers = users.filter(user =>
        user.full_name.toLowerCase().includes(query.toLowerCase()) ||
        user.first_name.toLowerCase().includes(query.toLowerCase()) ||
        user.barcode.toLowerCase().includes(query.toLowerCase())
    );
    
    console.log(`✅ Gefundene Benutzer (${filteredUsers.length}):`, filteredUsers);
    return filteredUsers;
}

// 6. Manuelle Benutzerauswahl
function selectUserManually(userId = 1) {
    console.log(`🧪 Testing Manual User Selection: ${userId}`);
    
    if (window.kasse && typeof window.kasse.selectUserFromDropdown === 'function') {
        window.kasse.selectUserFromDropdown(userId);
        console.log('✅ Benutzer über Kasse-Objekt ausgewählt');
    } else {
        console.error('❌ Kasse-Objekt oder Methode nicht verfügbar!');
    }
}

// Tests ausführen
console.log('🚀 Führe Tests aus...');
testDropdown();
testUserSearch();

console.log('🛠️ Verfügbare Debug-Funktionen:');
console.log('- testDropdown() - Dropdown-Test');
console.log('- testUserSearch("query") - Suchtest');
console.log('- selectUserManually(1) - Manueller Benutzer-Test');

console.log('=== DEBUG COMPLETE ===');
