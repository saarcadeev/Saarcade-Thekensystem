// Debug-Script fÃ¼r Kassensystem - In Browser-Console einfÃ¼gen

console.log('=== KASSENSYSTEM DEBUG ===');

// 1. Grundlegende Elemente prÃ¼fen
const barcodeInput = document.getElementById('barcodeInput');
const userDropdown = document.getElementById('userDropdown');
const scannerCompact = document.getElementById('scannerCompact');

console.log('ğŸ“‹ Element-Check:');
console.log('- Barcode Input:', barcodeInput ? 'âœ…' : 'âŒ');
console.log('- User Dropdown:', userDropdown ? 'âœ…' : 'âŒ');
console.log('- Scanner Compact:', scannerCompact ? 'âœ…' : 'âŒ');

// 2. Globale Variablen prÃ¼fen
console.log('ğŸ“‹ Variable-Check:');
console.log('- window.kasse:', window.kasse ? 'âœ…' : 'âŒ');
console.log('- users array:', Array.isArray(users) ? `âœ… (${users.length} Benutzer)` : 'âŒ');
console.log('- products array:', Array.isArray(products) ? `âœ… (${products.length} Produkte)` : 'âŒ');

// 3. Event-Listener testen
console.log('ğŸ“‹ Event-Listener-Test:');
if (barcodeInput) {
    console.log('- Input Events:', barcodeInput._events ? 'âœ…' : 'âŒ');
}

// 4. Dropdown-Test
function testDropdown() {
    console.log('ğŸ§ª Testing Dropdown...');
    
    if (!userDropdown) {
        console.error('âŒ Dropdown-Element nicht gefunden!');
        return;
    }
    
    // Test-HTML einfÃ¼gen
    userDropdown.innerHTML = `
        <div class="user-dropdown-item" data-user-id="1">
            <div class="user-dropdown-avatar">M</div>
            <div class="user-dropdown-info">
                <div class="user-dropdown-name">ğŸ‘¥ Max Mustermann</div>
                <div class="user-dropdown-details">Mitglied â€¢ -15.50â‚¬</div>
            </div>
        </div>
    `;
    
    userDropdown.classList.add('show');
    console.log('âœ… Test-Dropdown angezeigt');
    
    // Click-Test
    const testItem = userDropdown.querySelector('.user-dropdown-item');
    if (testItem) {
        testItem.addEventListener('click', () => {
            console.log('âœ… Dropdown-Click funktioniert!');
            console.log('User ID:', testItem.dataset.userId);
        });
        console.log('âœ… Click-Handler hinzugefÃ¼gt');
    }
}

// 5. Benutzersuche testen
function testUserSearch(query = 'max') {
    console.log(`ğŸ§ª Testing User Search with: "${query}"`);
    
    if (!Array.isArray(users)) {
        console.error('âŒ Users-Array nicht verfÃ¼gbar!');
        return;
    }
    
    const filteredUsers = users.filter(user =>
        user.full_name.toLowerCase().includes(query.toLowerCase()) ||
        user.first_name.toLowerCase().includes(query.toLowerCase()) ||
        user.barcode.toLowerCase().includes(query.toLowerCase())
    );
    
    console.log(`âœ… Gefundene Benutzer (${filteredUsers.length}):`, filteredUsers);
    return filteredUsers;
}

// 6. Manuelle Benutzerauswahl
function selectUserManually(userId = 1) {
    console.log(`ğŸ§ª Testing Manual User Selection: ${userId}`);
    
    if (window.kasse && typeof window.kasse.selectUserFromDropdown === 'function') {
        window.kasse.selectUserFromDropdown(userId);
        console.log('âœ… Benutzer Ã¼ber Kasse-Objekt ausgewÃ¤hlt');
    } else {
        console.error('âŒ Kasse-Objekt oder Methode nicht verfÃ¼gbar!');
    }
}

// Tests ausfÃ¼hren
console.log('ğŸš€ FÃ¼hre Tests aus...');
testDropdown();
testUserSearch();

console.log('ğŸ› ï¸ VerfÃ¼gbare Debug-Funktionen:');
console.log('- testDropdown() - Dropdown-Test');
console.log('- testUserSearch("query") - Suchtest');
console.log('- selectUserManually(1) - Manueller Benutzer-Test');

console.log('=== DEBUG COMPLETE ===');
